--unloading the data from snowflake to s3--
SELECT * FROM CAPS;

COPY INTO @CAPS_UNLOADING FROM CAPS FILE_FORMAT=(TYPE='CSV' COMPRESSION=NONE);

--loading data from s3 to snowflake using storage integration and pipeline--
LIST @CAPS_UNLOADING;

CREATE OR REPLACE STORAGE INTEGRATION CAPS_INTEGRATION
TYPE = EXTERNAL_STAGE
STORAGE_PROVIDER = 'S3'
STORAGE_AWS_ROLE_ARN = 'arn:aws:iam::934597569459:role/capstone_role'
STORAGE_ALLOWED_LOCATIONS = ('s3://capsbkt/scr/')
ENABLED = TRUE;

DESC INTEGRATION CAPS_INTEGRATION;

CREATE OR REPLACE PIPE CAPSTONE_PIPE
AUTO_INGEST = TRUE
AS
COPY INTO CAPS2
FROM @CAPS_LOADING
FILE_FORMAT = (TYPE = 'CSV' SKIP_HEADER=1) ;

DESC PIPE CAPSTONE_PIPE;

SELECT * FROM CAPS2;

